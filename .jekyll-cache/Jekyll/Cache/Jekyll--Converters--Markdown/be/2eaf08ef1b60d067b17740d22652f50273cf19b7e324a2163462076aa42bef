I"î <h1 id="deepexploitå·¥å…·è°ƒç ”">DeepExploitå·¥å…·è°ƒç ”</h1>

<p>Deep Exploitæ˜¯ä¸€æ¬¾å¯ä¸Metasploité“¾æ¥ä½¿ç”¨ï¼Œä¸”ç»“åˆæœºå™¨å­¦ä¹ çš„å…¨è‡ªåŠ¨æ¸—é€æµ‹è¯•å·¥å…·ã€‚</p>

<h2 id="0x00-å®‰è£…">0x00 å®‰è£…</h2>

<h3 id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤</h3>

<p>æ ¹æ®å®˜æ–¹å®‰è£…æ‰‹å†Œï¼šhttps://github.com/13o-bbr-bbq/machine_learning_security/wiki/Installation</p>

<ol>
  <li>
    <p>å®‰è£…Kali</p>
  </li>
  <li>
    <p>å‘½ä»¤æ‰§è¡Œ<code class="highlighter-rouge">git clone https://github.com/13o-bbr-bbq/machine_learning_security.git</code></p>
  </li>
  <li>
    <p>å‘½ä»¤æ‰§è¡Œ å®‰è£…python3çš„pip<code class="highlighter-rouge">apt-get install python3-pip</code></p>
  </li>
  <li>
    <p>åˆ‡æ¢åˆ°DeepExploitç›®å½•ä¸‹è¿è¡Œ<code class="highlighter-rouge">pip3 install -r requirements.txt</code></p>
  </li>
  <li>
    <p>ç¼–è¾‘<code class="highlighter-rouge">config.ini</code>ï¼Œä¿®æ”¹å…¶ä¸­çš„<code class="highlighter-rouge">server_host</code>ä¸ºæœ¬æœºIP(ifconfigæŸ¥çœ‹ä¸€ä¸‹ï½)</p>
  </li>
  <li>
    <p>ç¼–è¾‘<code class="highlighter-rouge">proxychains.conf</code>ï¼Œä¿®æ”¹ç›‘å¬IPå’Œç«¯å£ï¼ˆè¦æ±‚å’ŒDeepExploitç›®å½•ä¸‹<code class="highlighter-rouge">config.ini</code>çš„<code class="highlighter-rouge">proxy_host</code>ã€<code class="highlighter-rouge">proxy_port</code>å¯¹åº”ï¼‰</p>
  </li>
  <li>
    <p>åˆå§‹åŒ–Metasploit DBï¼Œå‘½ä»¤æ‰§è¡Œ<code class="highlighter-rouge">msfdb init</code></p>
  </li>
  <li>
    <p>å¯åŠ¨Metasploitï¼Œå‘½ä»¤æ‰§è¡Œ<code class="highlighter-rouge">msfconsole</code></p>
  </li>
  <li>
    <p>å¯åŠ¨Metasploit RPCæœåŠ¡ï¼Œå‘½ä»¤æ‰§è¡Œ</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf &gt; load msgrpc ServerHost=172.16.108.139 ServerPort=55553 User=test Pass=test1234
[*] MSGRPC Service:  172.16.108.139:55553 
[*] MSGRPC Username: test
[*] MSGRPC Password: test1234
[*] Successfully loaded plugin: msgrpc
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="å®‰è£…çš„å‘è®°å½•">å®‰è£…çš„å‘è®°å½•</h3>

<ul>
  <li>
    <p>å®‰è£…Scrapyåº“æ—¶æŠ¥Twistedé”™è¯¯</p>

    <blockquote>
      <p>Python.h: No such file or directory</p>
    </blockquote>

    <p>è§£å†³æ–¹æ³•ï¼šè¿è¡Œå‘½ä»¤<code class="highlighter-rouge">sudo apt install python3.6-dev</code>å®‰è£…<code class="highlighter-rouge">python3.6-dev</code></p>
  </li>
  <li>
    <p>è¿è¡ŒDeepExploitæŠ¥é”™</p>

    <blockquote>
      <p>ImportError: numpy.core.multiarray failed to import</p>
    </blockquote>

    <p>è§£å†³æ–¹æ³•ï¼šè¾“å…¥python3è¿›å…¥äº¤äº’ç•Œé¢-&gt;<code class="highlighter-rouge">import numpy</code>-&gt;<code class="highlighter-rouge">print(numpy.__path__)</code>-&gt;è·å¾—numpyçš„å®‰è£…è·¯å¾„é€€å‡ºäº¤äº’ç•Œé¢ï¼Œè¿è¡Œ<code class="highlighter-rouge">sudo rm -r å®‰è£…è·¯å¾„</code>åˆ é™¤numpyï¼Œç„¶åè¿è¡Œ<code class="highlighter-rouge">sudo apt install python3-numpy</code></p>
  </li>
  <li>
    <p>è¿è¡Œæ—¶ä¼šæŠ¥é”™</p>

    <blockquote>
      <p>/usr/lib/python3/dist-packages/requests/<strong>init</strong>.py:80: RequestsDependencyWarning: urllib3 (1.24.1) or chardet (3.0.4) doesnâ€™t match a supported version!</p>
    </blockquote>

    <p>æŸ¥é˜…äº†ä¸€ä¸‹èµ„æ–™è¯´è¿™ä¸ªæç¤ºä¸ä¼šå½±å“ä½¿ç”¨ï¼Œæ‰€ä»¥æ— éœ€å¤„ç†ã€‚</p>
  </li>
</ul>

<h2 id="0x01-ä½¿ç”¨å·¥ä½œåŸç†">0x01 ä½¿ç”¨&amp;å·¥ä½œåŸç†</h2>

<h3 id="deepexploit-trainæ¨¡å¼">DeepExploit Trainæ¨¡å¼</h3>

<p>æ‰§è¡Œå‘½ä»¤ï¼š<code class="highlighter-rouge">python3 DeepExploit.py -t åœ°å€ -m train</code></p>

<table>
  <thead>
    <tr>
      <th>command options</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-t, â€“target</td>
      <td>è®­ç»ƒæ˜“å—æ”»å‡»ä¸»æœºçš„IPåœ°å€</td>
    </tr>
    <tr>
      <td>-m, â€“mode</td>
      <td>æ‰§è¡Œæ¨¡å¼â€è®­ç»ƒâ€</td>
    </tr>
  </tbody>
</table>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/0.png" alt="train" /></p>

<h4 id="è®­ç»ƒè¿‡ç¨‹">è®­ç»ƒè¿‡ç¨‹</h4>

<p>åŠŸèƒ½æœ‰ç‚¹åƒMetasploitä¹‹å‰çš„db_autopwnã€‚</p>

<ul>
  <li>
    <p>é€šè¿‡Nmapè¿›è¡Œç«¯å£æ‰«æï¼Œå°†æ‰«æç»“æœè¿›è¡Œè¾“å‡ºï¼š<code class="highlighter-rouge">[*] nmap -p0-65535 -T5 -Pn -sV -sT --min-rate 1000 -oX nmap_result_172.16.108.140.xml 172.16.108.140</code></p>
  </li>
  <li>
    <p>ä»æ‰«æç»“æœä¸­è·å–å·²å¼€æ”¾çš„ç«¯å£ä¿¡æ¯ï¼š<code class="highlighter-rouge">[+] Get port list from nmap_result_172.16.108.140.xml.</code></p>
  </li>
  <li>
    <p>è½½å…¥Metasploitçš„Exploitæ¨¡å—åˆ—è¡¨ï¼š<code class="highlighter-rouge">[+] Get exploit list.</code>ï¼Œè½½å…¥Metaploitçš„Payloadæ¨¡å—åˆ—è¡¨ï¼š<code class="highlighter-rouge">[+] Get payload list.</code>ï¼Œè·å–æ¯ä¸ªæ¨¡å—çš„é€‰é¡¹è®¾ç½®ä¿¡æ¯ã€‚</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[+] Get exploit list.
[*] Loaded exploit list from : /root/machine_learning_security/DeepExploit/data/exploit_list.csv
[+] Get payload list.
[*] Loaded payload list from : /root/machine_learning_security/DeepExploit/data/payload_list.csv
[+] Get exploit tree.
[*] Loaded exploit tree from : /root/machine_learning_security/DeepExploit/data/exploit_tree.json
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–ç«¯å£ä¿¡æ¯ï¼Œæ£€æŸ¥WEBç«¯å£<code class="highlighter-rouge">[+] Get target info. [+] Check web port.</code>ï¼Œé’ˆå¯¹å¼€æ”¾çš„WEBæœåŠ¡è¿›è¡Œç«™å†…é“¾æ¥çˆ¬è™«ã€‚</p>
  </li>
  <li>
    <p>é’ˆå¯¹çˆ¬è™«çˆ¬å–çš„é“¾æ¥è¿›è¡ŒCMSæŒ‡çº¹è¯†åˆ«ï¼ˆé™æ€è§„åˆ™é’ˆå¯¹é“¾æ¥çš„å“åº”å†…å®¹è¿›è¡Œåˆ†æï¼‰</p>

    <p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/1.png" alt="cms" /></p>

    <p>è½½å…¥å­—å…¸å¯¹ç½‘ç«™ç›®å½•è¿›è¡Œæš´åŠ›çŒœè§£ï¼š</p>

    <p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/6.png" alt="" /></p>
  </li>
  <li>
    <p>åˆ†æå¼€æ”¾çš„ç«¯å£ï¼ˆè·å–ç«¯å£å¯¹åº”çš„æœåŠ¡ç­‰ä¿¡æ¯ï¼‰é€‰æ‹©å¯¹åº”çš„ä¿¡æ¯çš„æµ‹è¯•æ¨¡å—ï¼ˆmetasploitï¼‰</p>

    <p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/7.png" alt="" /></p>
  </li>
  <li>
    <p>è½½å…¥Metasploitæ¨¡å—è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•</p>

    <p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/2.png" alt="exploit" /></p>
  </li>
  <li>
    <p>è®­ç»ƒç»“æŸï¼š</p>

    <p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/3.png" alt="end" /></p>
  </li>
</ul>

<h4 id="è®­ç»ƒç»“æœæŠ¥å‘Š">è®­ç»ƒç»“æœæŠ¥å‘Š</h4>

<p>æœ€ç»ˆæµ‹è¯•ç»“æŸä»¥åï¼ŒæŠ¥å‘Šä¼šå­˜å‚¨åœ¨<code class="highlighter-rouge">/report/train</code>ä¸‹ï¼š</p>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/4.png" alt="result" /></p>

<p>åˆ‡æ¢åˆ°DeepExploitç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼š<code class="highlighter-rouge">python3 CreateReport.py -m train </code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>+] Creating training report.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating training report <span class="k">done</span><span class="nb">.</span>
</code></pre></div></div>

<p>åœ¨<code class="highlighter-rouge">/report/train</code>ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª<code class="highlighter-rouge">DeepExploit_train_report.html</code>çš„HTMLæŠ¥å‘Šæ–‡ä»¶ï¼Œæ‰“å¼€æŸ¥çœ‹ç»“æœï¼š</p>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/5.png" alt="result" /></p>

<h3 id="deepexploit-testæ¨¡å¼">DeepExploit Testæ¨¡å¼</h3>

<p>æ‰§è¡Œå‘½ä»¤<code class="highlighter-rouge">python3 DeepExploit.py -t 172.16.108.140 -m test</code></p>

<p>æµç¨‹ä¸DeepExploit Trainæ¨¡å¼ä¸€æ ·ï¼Œå¦‚æœDeep ExploitæˆåŠŸåˆ©ç”¨äº†ç›®æ ‡æœåŠ¡å™¨ï¼Œå®ƒä¼šè¿›ä¸€æ­¥çš„å¯¹å…¶ä»–å†…éƒ¨æœåŠ¡å™¨è¿›è¡Œæ¨ªè¡Œæ”»å‡»ã€‚</p>

<h3 id="é—®é¢˜">é—®é¢˜</h3>

<p>æµ‹è¯•é¶æœºæœ‰445ç«¯å£å¼€æ”¾ï¼Œå¹¶ä¸”å­˜åœ¨æ¼æ´ã€‚</p>

<p>DeepExploitåœ¨åšæ¢æµ‹çš„æ—¶å€™ä¹Ÿæ£€æµ‹åˆ°äº†ç«¯å£çš„å¼€æ”¾æƒ…å†µï¼š</p>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/8.png" alt="" /></p>

<p>ä½†æ˜¯445ç«¯å£åœ¨åŒ¹é…Metasploitæ¨¡å—çš„æ—¶å€™å´æ˜¯0ï¼Œæ²¡æœ‰åˆ©ç”¨æ¨¡å—ï¼š</p>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/9.png" alt="" /></p>

<p>ç«¯å£åŒ¹é…æ¨¡å—ä½¿ç”¨çš„æ˜¯Metasploitçš„searchè¯­æ³•ï¼š</p>

<p><code class="highlighter-rouge">search_cmd = 'search name:' + service_name + ' type:exploit app:server\n'</code></p>

<p>è°ƒè¯•è¾“å‡ºservice_nameï¼Œå‘ç°445ç«¯å£çš„æ˜¯unknownï¼Œæ‰€ä»¥æ— æ³•æœç´¢å‡ºåˆ©ç”¨æ¨¡å—ã€‚</p>

<p><img src="https://vulkey.oss-cn-hangzhou.aliyuncs.com/2019-07-04/10.png" alt="" /></p>

:ET